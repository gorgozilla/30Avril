!function(t){"use strict";var e={},n={},o={start:0,end:0},i={};e.Editor=Backbone.Model,n.Editor=Backbone.View.extend({events:{"click .meditor-bold":"toggle_bold","click .meditor-italic":"toggle_italic","click .meditor-underline":"toggle_underline","click .meditor-nlist":"toggle_nlist","click .meditor-blist":"toggle_blist","click .meditor-ralign":"toggle_ralign","click .meditor-lalign":"toggle_lalign","click .meditor-calign":"toggle_calign","click .meditor-jalign":"toggle_jalign","click .meditor-indent":"toggle_indent","click .meditor-outdent":"toggle_outdent","click .meditor-heading":"toggle_heading","click .meditor-redo":"toggle_redo","click .meditor-undo":"toggle_undo","click .font-size":"change_font_size","keyup #font-size":"insert_font_size","click .meditor-font-family":"change_font_family","click .submenu-meditor-font-family":"change_font_family","keyup #meditor-font-family":"insert_font_family","click .letter-space":"change_letter_space","keyup #letter-space":"insert_letter_space","click .line-height":"change_line_height","keyup #line-height":"insert_line_height","click .meditor-font-color":"change_font_color","click .open-extra-option":"toggle_open_url_panel","click .close-panel":"close_url_panel","click .link":"change_link","keyup .link-input":"insert_link_url","keydown .meditor-input":"validate_input","click .active-item":"input_focus","click .mdb-insert-link":"link_input_focus"},initialize:function(){this.$el=t(this.el),_.bindAll(this,"change_buttons","change_editable"),this.model.bind("change:buttons",this.change_buttons),this.model.bind("change:editable",this.change_editable),this.change_editable()},init_color_picker:function(){var e=this;new ColorPicker(document.getElementById("meditor-color-picker"),{onUpdate:function(n){var o="rgb("+n[0]+", "+n[1]+", "+n[2]+")";t(".meditor-defult-font-color").css("background","rgb("+n[0]+", "+n[1]+", "+n[2]+")"),e.toggle_color(o)}});t("#color-picker-input").on("keyup",function(n){13==n.keyCode&&e.toggle_color(t(this).val())})},change_editable:function(){this.set_button_class()},set_button_class:function(){var t=this.model.get("editable").attr("data-button-class")||"default";this.model.set({buttons:l.config.button_classes[t]})},change_buttons:function(){var e=this,n=this.$el,o="";this.$el.empty();var i=this.model.get("buttons");return _.isEmpty(i)?void t(this.el).hide():void _.each(i,function(t){var i="create_"+t["class"].replace(/-/g,"_");o="","function"==typeof e[i]&&(o=e[i](t)),n.append(o)})},auto_complete:function(t){t=t.toLowerCase();var e=[],n=[],o=a.call(font_name_list,t),i=o-1;if(-1==o)return{font_array:e,font_var:n};var l=0;for(o;o<=font_name_list_len&&(l++,5>l&&font_name_list[o].substr(0,t.length).toLowerCase()==t);o++)e.push(font_name_list[o]),n.push(font_var_list[o]);for(l=0,i;i>=0&&(l++,5>l&&font_name_list[i].substr(0,t.length).toLowerCase()==t);i--)e.push(font_name_list[i]),n.push(font_var_list[i]);return{font_array:e,font_var:n}},change_font_color:function(){var e=document.getElementById("meditor_focus");null!=e&&r(e),this.keep_text_selected();var n=t("#meditor-color-picker");t(".color-picker-container").length||this.init_color_picker(),n.hasClass("open")?this.close_color_picker(n):this.open_color_picker(n)},open_color_picker:function(e){var n=t(".meditor-defult-font-color").css("background-color");n=this.rgb2hex(n),t(".color-picker-container .picker-container .canvas-container input").val(n).keyup(),e.addClass("open")},close_color_picker:function(t){t.removeClass("open")},create_text_alignment:function(t){var e={toolbar_icon:"mdb-align-left",value:t.data,data_value:{justifyleft:{toolbar_icon:"mdb-align-left",value:"left_align",meditor_class:"meditor-lalign"},justifycenter:{toolbar_icon:"mdb-align-center",value:"center_align",meditor_class:"meditor-calign"},justifyright:{toolbar_icon:"mdb-align-right",value:"right_align",meditor_class:"meditor-ralign"},justifyfull:{toolbar_icon:"mdb-justify",value:"full_align",meditor_class:"meditor-jalign"}},value_type:"button",has_input:!1},n='<div class="group-style-controller2 with-border '+t["class"]+'">';return n+=this.create_dropdown(e),n+="</div>"},create_font_family_controller:function(t){var e={toolbar_icon:"meditor-defult-text",value:["Open Sans","Montserrat","Playfair Display","Poppins","Roboto","Raleway","Oswald","Lato"],data_value:["Open Sans","Montserrat","Playfair Display","Poppins","Roboto","Raleway","Oswald","Lato"],value_type:"text",text:"Open Sans",has_input:!0,has_placeholder:"Google font",meditor_class:"meditor-font-family",has_submenu:!0,submenu_value:[[{text:"300"},{text:"300italic"},{text:"regular"},{text:"italic"},{text:"600"},{text:"600italic"},{text:"700"},{text:"800italic"},{text:"800"}],[{text:"regular"},{text:"700"}],[{text:"regular"},{text:"italic"},{text:"700"},{text:"700italic"},{text:"900"},{text:"900italic"}],[{text:"regular"},{text:"300"},{text:"500"},{text:"600"},{text:"700"}],[{text:"100"},{text:"100italic"},{text:"300"},{text:"300italic"},{text:"regular"},{text:"italic"},{text:"500"},{text:"500italic"},{text:"600"},{text:"600italic"},{text:"700"},{text:"700italic"},{text:"800"},{text:"800italic"},{text:"900"},{text:"900italic"}],[{text:"100"},{text:"200"},{text:"300"},{text:"regular"},{text:"500"},{text:"600"},{text:"700"},{text:"800"},{text:"900"}],[{text:"300"},{text:"regular"},{text:"700"}],[{text:"100"},{text:"100italic"},{text:"300"},{text:"300italic"},{text:"regular"},{text:"italic"},{text:"700"},{text:"700italic"},{text:"900"},{text:"900italic"}]]},n='<div class="with-border '+t["class"]+(t.have_input?" have-input":"")+'" >'+this.create_dropdown(e)+"</div>";return n},create_font_color:function(t){var e='<div class="with-border font-color-controller'+(t.have_input?" have-input":"")+'" ><button class=" meditor-'+t["class"]+'"><span class="meditor-defult-font-color" ></span></button><div id="meditor-color-picker" ></div></div>';return e},create_bold:function(t){var e='<div class="bold-controller" ><button class=" meditor-'+t["class"]+'"><span class="meditor-defult-bold mdb-bold"></span></button></div>';return e},create_italic:function(t){var e='<div class="italic-controller"  ><button class=" meditor-'+t["class"]+'"><span class="meditor-defult-italic mdb-italic" ></span></button></div>';return e},create_underline:function(t){var e='<div class="with-border underline-controller" ><button class=" meditor-'+t["class"]+'"><span class="meditor-defult-underline mdb-underline"></span></button></div>';return e},create_heading:function(t){var e={toolbar_icon:"mdb-heading-1",value:["mdb-heading-1","mdb-heading-2","mdb-heading-3","mdb-heading-4","mdb-heading-5","mdb-heading-6","mdb-heading-p"],data_value:[1,2,3,4,5,6,7],value_type:"icon",has_input:!1,meditor_class:"meditor-heading"},n='<div class="heading-controller with-border '+t["class"]+'" >';return n+=this.create_dropdown(e),n+="</div>"},create_line_height:function(t){var e={toolbar_icon:"mdb-line-height",value:[1,1.2,1.5,1.7,2],data_value:[1,1.2,1.5,1.7,2],value_type:"text",has_input:!0,input_type:"number",meditor_class:"line-height"},n='<div class="with-border line-height-controller exception '+(t.have_input?" have-input":"")+'" >';return n+=this.create_dropdown(e),n+="</div>"},create_font_size:function(t){var e={toolbar_icon:"",item_unit:"px",value:[6,8,9,10,11,12,14,16,18,20,22,24,26,28,30],data_value:[6,8,9,10,11,12,14,16,18,20,22,24,26,28,30],value_type:"text",has_input:!0,input_type:"number",meditor_class:"font-size"},n='<div class="font-size-controller'+(t.have_input?" have-input":"")+'">';return n+=this.create_dropdown(e),n+="</div>"},create_letter_space:function(t){var e={toolbar_icon:"mdb-letter-spacing",value:[1,2,3,4,5],data_value:[1,2,3,4,5],value_type:"text",has_input:!0,meditor_class:"letter-space"},n='<div class="letter-space-controller with-border exception '+(t.have_input?" have-input":"")+' ">';return n+=this.create_dropdown(e),n+="</div>"},create_group_style:function(t){var e={toolbar_icon:"mdb-unorder-list",value:t.data,data_value:{orderedlist:{toolbar_icon:"mdb-order-list",value:"ol",meditor_class:"meditor-nlist"},unorderedlist:{toolbar_icon:"mdb-unorder-list",value:"ul",meditor_class:"meditor-blist"},indent:{toolbar_icon:"mdb-increase-indent",value:"indent",meditor_class:"meditor-indent"},outdent:{toolbar_icon:"mdb-decrease-indent",value:"outdent",meditor_class:"meditor-outdent"}},value_type:"button",has_input:!1},n='<div class="group-style-controller1 with-border '+t["class"]+'">';return n+=this.create_dropdown(e),n+="</div>"},create_dropdown:function(t){var e=t.text?t.text:"",n='<button class="active-item" >';return n+='<span class="text-controller-icon '+t.toolbar_icon+'">'+e+"</span>",n+="undefined"!=typeof t.item_unit?'<span class="unit">'+t.item_unit+"</span>":'<span class="mdb-down-arow"></span>',n+="</button>",n+='<div class="dropdown-items '+t.value_type+'">',t.has_input&&t.has_placeholder?(n+='<input id="'+t.meditor_class+'" class="meditor-input" data_input_type="'+t.input_type+'" type="text" placeholder="'+t.has_placeholder+'">',n+='<span class="icon-search3 meditor-icon-search"></span>'):t.has_input&&(n+='<input id="'+t.meditor_class+'" class="meditor-input" data_input_type="'+t.input_type+'" type="text" >'),n+=this.create_dropdown_options(t),n+="</div>",this.open_dropdown(),this.active_dropdown_item(),n},update_dropdown:function(e){var n=t("."+e.item_class).find(".dropdown-items");n.find("div.meditor-font-family").remove(),n.append(this.create_dropdown_options(e))},create_dropdown_options:function(t){var e,n="";if("button"!=t.value_type)for(e=0;e<t.value.length;e++)"icon"==t.value_type?n+='<div class="'+t.meditor_class+" "+t.value[e]+'" data-format="'+t.data_value[e]+'">':t.data_value[e].length<17?(n+='<div class="'+t.meditor_class+'" data-format="'+t.data_value[e]+'"><span class="text-variant-icon"  data-format="'+t.data_value[e]+'">'+t.value[e]+"</span>",NaN+t.value[e]+"</span>"):n+='<div class="'+t.meditor_class+'" data-format="'+t.data_value[e]+'" title="'+t.data_value[e]+'"><span class="text-variant-icon" data-format="'+t.data_value[e]+'">'+t.value[e]+"</span>",1==t.has_submenu&&(n+=this.create_submenu(t,e)),n+="</div>";else for(var e in t.data_value)n+='<div class="'+t.data_value[e].meditor_class+" "+t.data_value[e].toolbar_icon+'" data-format="'+t.data_value[e].index+'"></div>';return n},create_submenu:function(t,e){var n='<div class="submenu" >';for(var o in t.submenu_value[e]){var i;i="regular"==t.submenu_value[e][o].text||"normal"==t.submenu_value[e][o].text?400:t.submenu_value[e][o].text,n+='<div class=" submenu-'+t.meditor_class+" "+t.value[e]+'" data-format="'+t.data_value[e]+'" data-font-var="'+i+'" >'+t.submenu_value[e][o].text+"</div>"}return n+="</div>"},open_dropdown:function(){var e=this;t("body").off("click",".active-item"),t("body").on("click",".active-item",function(){var n=document.getElementById("meditor_focus");if(null!=n&&r(n),t(this).closest(".have-input").length&&e.keep_text_selected(),t(this).next(".dropdown-items").hasClass("open"))var o="";else var o="open";e.close_dropdown(),t(this).next(".dropdown-items").addClass(o)})},close_dropdown:function(){t(".active-item + .dropdown-items , .open-link-option").removeClass("open show-panel")},active_dropdown_item:function(){var e=this;t("body").off("click",".dropdown-items > div"),t("body").on("click",".dropdown-items > div",function(){var n=t(this).closest(".dropdown-items");t(this).siblings().removeClass("active"),t(this).addClass("active");for(var o,i=t(this).attr("class"),l=i.split(" "),a=0;a<l.length;a++)0==l[a].indexOf("mdb")&&(o=l[a]);n.hasClass("icon")||n.hasClass("button")?n.prev().find(".text-controller-icon").attr("class","").addClass("text-controller-icon "+o):n.parent().hasClass("exception")||n.prev().find(".text-controller-icon").text(t(this).text()),e.close_dropdown()})},input_focus:function(e){var n=e.target||e.srcElement;setTimeout(function(){t(n).closest(".active-item").siblings(".dropdown-items").find(".meditor-input").focus()},10)},link_input_focus:function(e){var n=e.target||e.srcElement;setTimeout(function(){t(n).closest(".open-extra-option").siblings(".open-link-option").find(".link-input").focus()},10)},validate_input:function(e){"number"==t(e.target).attr("data_input_type")&&e.keyCode>=65&&e.keyCode<=90&&e.preventDefault()},create_undo_redo_manger:function(t){var e='<div class="'+t["class"]+'" >'+this.create_redo(t)+this.create_undo(t)+"</div>";return e},create_redo:function(t){var e='<div class="redo"><button class="meditor-redo"><span class="mdb-redo"></span></button></div>';return e},create_undo:function(t){var e='<div class="undo"><button class="meditor-undo"><span class="mdb-undo"></span></button></div>';return e},link_panel:function(){if(t(".keep-text-selected").length){var e=t(".keep-text-selected").offset().top,n=t(".keep-text-selected").height(),o=t(".keep-text-selected").offset().left,i=t(".insert-link").offset().top,l=t(".insert-link").offset().left;t(".open-link-option").css({top:e+n-i,left:o-l})}else t(".open-link-option").css({top:"37px",left:"-148px"})},create_link:function(t){var e='<div class="insert-'+t["class"]+' link-controller with-border" ><button class="open-extra-option"><span class="mdb-insert-link" ></span> </button><div class="open-link-option" ><div class="meditor-link-input"> <input class="link-input" type="url" placeholder="URl" /> </div><div><span class="mdb-check '+t["class"]+'" ></span> </div><div><span class="mdb-close close-panel"></span> </div><div class="open-link-extra" > <div class="rounded"><input type="checkbox" id="rounded" class="open-link-new-tab"  name="check"/> <label for="rounded"></label></div><label for="rounded"> <p>Open in new window</p></label></div></div></div>';return e},close_url_panel:function(){t(".link-input").val(""),t(".link").click(),this.remove_text_selection(),this.set_selection_range(document.getElementById("meditor_focus"),o.start,o.end)},toggle_open_url_panel:function(){t(".active-item + .dropdown-items").removeClass("open");var e=document.getElementById("meditor_focus");null!=e&&r(e),this.keep_text_selected(),this.set_selection_range(document.getElementById("meditor_focus"),o.start,o.end),t(".open-link-option").toggleClass("show-panel"),t(".link-input").val(""),this.link_panel()},change_font_size:function(e,n){this.set_selection_range(document.getElementById("meditor_focus"),o.start,o.end);var i="undefined"!=typeof n?n:t(e.target).attr("data-format");this.update_font_size_controller([!0,i]);var l=this.get_selection_html(),a=t("<div>").html(l.html),r=a.find("span");r.length?r.css({"font-size":i+"px"}):a.html('<span style="font-size: '+i+'px">'+a.html()+"</span>");var s=a.html();this.replace_selection_with_html(s),this.remove_extra_li(),this.remove_extra_space()},insert_font_size:function(e){if(13==e.keyCode){t.isNumeric(t(e.target).val())?t(e.target).val():14;this.change_font_size(e,t(e.target).val()),t(e.target).focus()}},change_letter_space:function(e,n){var o="undefined"==typeof n?t(e.target).attr("data-format"):n,i=document.getElementById("meditor_focus");i.style.letterSpacing=o+"px",i.setAttribute("data-letterspace",o),t(i).find("h1,h2,h3,h4,h5,h6,p,span").css("letter-spacing",o+"px"),this.update_letter_spacing_controller([!0,o]);var l=t("#meditor_focus").closest(".mBuilder-element").attr("data-mbuilder-id");builder.setModelattr(l,"meditor_letter_spacing",o)},insert_letter_space:function(e){13==e.keyCode&&this.change_letter_space(e,t(e.target).val())},change_line_height:function(e,n){var o="undefined"==typeof n?t(e.target).attr("data-format"):n,i=document.getElementById("meditor_focus");i.style.lineHeight=o+"em",i.setAttribute("data-lineheight",o),t(i).find("h1,h2,h3,h4,h5,h6,p,span").css("line-height",o+"em"),this.update_line_height_controller([!0,o]);var l=t("#meditor_focus").closest(".mBuilder-element").attr("data-mbuilder-id");builder.setModelattr(l,"meditor_line_height",o)},insert_line_height:function(e){13==e.keyCode&&this.change_line_height(e,t(e.target).val())},change_font_family:function(e,n){e.stopPropagation();var i="undefined"!=typeof n?n:t(e.target).attr("data-format"),l=t(e.target).attr("data-font-var"),a="undefined"!=typeof l?l:"regular";this.set_selection_range(document.getElementById("meditor_focus"),o.start,o.end),this.load_font(i,a),this.update_font_family_controller([!0,i]),document.execCommand("StyleWithCSS",!1,!0),document.execCommand("fontName",!1,i),document.execCommand("StyleWithCSS",!1,!1),this.set_font_variant(i,l)},set_font_variant:function(e,n){var o=this.get_selection_html(),i=t("<div>").html(o.html),l=i.find("span");l.length?l.css({"font-weight":n,"font-family":e}):i.html("<span style='font-family: "+e+"; font-weight: "+n+"'>"+i.html()+"</span>");var a=i.html();this.replace_selection_with_html(a),this.remove_extra_li(),this.remove_extra_space()},remove_extra_li:function(){setTimeout(function(){t("#meditor_focus").find("li").each(function(){""==t(this).text().trim()&&t(this).remove()})},100)},remove_extra_space:function(){setTimeout(function(){t("#meditor_focus *").each(function(){""==t(this).text().trim()&&t(this).remove()})},100)},insert_font_family:function(e){var n=t(e.target).val();if(13==e.keyCode)return void this.change_font_family(e,n);var o=this.auto_complete(n),i={item_class:"font-family-controller",value:o.font_array,data_value:o.font_array,value_type:"text",meditor_class:"meditor-font-family",has_submenu:!0,submenu_value:o.font_var};t(".font-family-controller").html(this.update_dropdown(i))},load_font:function(t,e){WebFont.load({google:{families:[t+":"+e]}})},change_link:function(){var e=t(".link-input").val();if(0===e.length)document.execCommand("unlink",!1,!1),document.execCommand("underline",!1,null);else{-1==e.search("http://")&&-1==e.search("https://")&&-1==e.search("mailto")&&(e="http://"+e),this.set_selection_range(document.getElementById("meditor_focus"),o.start,o.end);var n=this.get_selection_html(),i=this.get_selection_html(),l=t("<div>").html(i.html);n=n.html,-1!=n.search("</a>")&&(document.execCommand("unlink",!1,!0),n=this.get_selection_html().html),t(".open-link-new-tab").is(":checked")?l.html("<u><a href='"+e+"' target='_blank'>"+n+"</a></u>"):l.html("<u><a href='"+e+"'>"+n+"</a></u>");var a=l.html();this.replace_selection_with_html(a)}this.remove_extra_li(),this.close_dropdown(),this.remove_text_selection(),this.remove_extra_space()},insert_link_url:function(e){13==e.keyCode&&this.change_link(e,t(e.target).val())},toggle_bold:function(t){t.preventDefault(),this.update_bold_controller(!0),document.execCommand("bold",!1,null)},toggle_italic:function(t){t.preventDefault(),this.update_italic_controller(!0),document.execCommand("italic",!1,null)},toggle_nlist:function(t){t.preventDefault(),this.update_list_controller([!0,"nlist"]),document.execCommand("insertorderedlist",!1,"")},toggle_blist:function(t){t.preventDefault(),this.update_list_controller([!0,"blist"]),document.execCommand("insertunorderedlist",!1,"")},toggle_underline:function(t){t.preventDefault();this.update_underline_controller(!0),document.execCommand("underline",!1,null)},toggle_ralign:function(t){t.preventDefault(),this.update_alignment_controller([!0,"ralign"]),document.execCommand("JustifyRight",!1,null)},toggle_lalign:function(t){t.preventDefault(),this.update_alignment_controller([!0,"lalign"]),document.execCommand("JustifyLeft",!1,null)},toggle_color:function(e){this.set_selection_range(document.getElementById("meditor_focus"),o.start,o.end);var n=this.get_selection_html(),i=t("<div>").html(n.html);e=this.rgb2hex(e);var l=i.find("span");l.length?l.css({color:e}):i.html("<span style='color: "+e+";'>"+i.html()+"</span>");var a=i.html();this.replace_selection_with_html(a),this.remove_extra_li(),this.remove_extra_space()},add_input_event:function(t){var e=this;document.getElementById(t).addEventListener("mouseup",function(){e.change_font_size()})},toggle_calign:function(t){t.preventDefault(),this.update_alignment_controller([!0,"calign"]),document.execCommand("justifyCenter",!1,null)},toggle_heading:function(e){var n=t(e.target).attr("data-format");document.execCommand("formatBlock",!1,7==n?"P":"H"+n)},toggle_jalign:function(t){t.preventDefault(),this.update_alignment_controller([!0,"jalign"]),document.execCommand("justifyFull",!1,null)},toggle_indent:function(t){t.preventDefault(),document.execCommand("indent",!1,null)},keep_text_selected:function(){document.execCommand("BackColor",!1,"#cbbe8e"),t('#meditor_focus [style*="background-color: rgb(203, 190, 142)"]').attr("class","keep-text-selected")},remove_text_selection:function(){o={start:0,end:0},t('#meditor_focus [style*="background-color: rgb(203, 190, 142)"]').removeClass("keep-text-selected").css("background-color","")},toggle_outdent:function(t){t.preventDefault(),document.execCommand("outdent",!1,null)},toggle_redo:function(t){t.preventDefault(),document.execCommand("redo",!1,null)},toggle_undo:function(t){t.preventDefault(),document.execCommand("undo",!1,null)},set_selection_range:function(t,e,n){if(0==e&&0==n)return!1;if(document.createRange&&window.getSelection){var o=document.createRange();o.selectNodeContents(t);for(var i,l,a=this.get_text_nodes_in(t),r=!1,s=0,c=0;l=a[c++];){if(i=s+l.length,!r&&e>=s&&(i>e||e==i&&c<=a.length)&&(o.setStart(l,e-s),r=!0),r&&i>=n){o.setEnd(l,n-s);break}s=i}var d=window.getSelection();d.removeAllRanges(),d.addRange(o)}else if(document.selection&&document.body.createTextRange){var u=document.body.createTextRange();u.moveToElementText(t),u.collapse(!0),u.moveEnd("character",n),u.moveStart("character",e),u.select()}},get_text_nodes_in:function(t){var e=[];if(3==t.nodeType)e.push(t);else for(var n=t.childNodes,o=0,i=n.length;i>o;++o)e.push.apply(e,this.get_text_nodes_in(n[o]));return e},hex:function(t){return("0"+parseInt(t).toString(16)).slice(-2)},rgb2hex:function(t){return/^#[0-9A-F]{6}$/i.test(t)?t:(t=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),"#"+this.hex(t[1])+this.hex(t[2])+this.hex(t[3]))},update_bold_controller:function(e,n){return 1==e?void t(".meditor-bold").toggleClass("me-active"):void("bold"==t(n).css("font-weight")?t(".meditor-bold").addClass("me-active"):t(".meditor-bold").removeClass("me-active"))},update_italic_controller:function(e,n){return 1==e?void t(".meditor-italic").toggleClass("me-active"):void("italic"==t(n).css("font-style")?t(".meditor-italic").addClass("me-active"):t(".meditor-italic").removeClass("me-active"))},update_underline_controller:function(e,n){return 1==e?void t(".meditor-underline").toggleClass("me-active"):void("underline"==t(n).css("text-decoration-line")?t(".meditor-underline").addClass("me-active"):"none"==t(n).css("text-decoration-line")&&("underline"==t(n).parents("span").css("text-decoration-line")?t(".meditor-underline").addClass("me-active"):t(".meditor-underline").removeClass("me-active")))},update_list_controller:function(e,n){return 1==e[0]?void t(".meditor-"+e[1]).toggleClass("me-active"):(t(n).parents("ol").length>0?t(".meditor-nlist").addClass("me-active"):t(".meditor-nlist").removeClass("me-active"),void(t(n).parents("ul").length>0?t(".meditor-blist").addClass("me-active"):t(".meditor-blist").removeClass("me-active")))},update_alignment_controller:function(e,n){return 1==e[0]?void t(".meditor-"+e[1]).toggleClass("me-active"):("center"==t(n).css("text-align")?(t(".meditor-panel .group-style-controller2 .text-controller-icon").removeClass("mdb-align-left mdb-align-right mdb-justify").addClass("mdb-align-center"),t(".meditor-calign").addClass("me-active")):t(".meditor-calign").removeClass("me-active"),"right"==t(n).css("text-align")?(t(".meditor-panel .group-style-controller2 .text-controller-icon").removeClass("mdb-align-left mdb-align-center mdb-justify").addClass("mdb-align-right"),t(".meditor-ralign").addClass("me-active")):t(".meditor-ralign").removeClass("me-active"),"left"==t(n).css("text-align")||"start"==t(n).css("text-align")?(t(".meditor-panel .group-style-controller2 .text-controller-icon").removeClass("mdb-align-center  mdb-align-right mdb-justify").addClass("mdb-align-left"),t(".meditor-lalign").addClass("me-active")):t(".meditor-lalign").removeClass("me-active"),void("justify"==t(n).css("text-align")?(t(".meditor-panel .group-style-controller2 .text-controller-icon").removeClass("mdb-align-left mdb-align-center mdb-align-right").addClass("mdb-justify"),t(".meditor-jalign").addClass("me-active")):t(".meditor-jalign").removeClass("me-active")))},update_font_size_controller:function(e,n){var o=0==e[0]?t(n).css("font-size").replace("px",""):e[1];t(".font-size-controller .active-item .text-controller-icon").text(parseInt(o))},update_letter_spacing_controller:function(e,n){var o=0==e[0]?t(n).css("letter-spacing").replace("px",""):e[1];t(".letter-space-controller .dropdown-items .meditor-input").val(o)},update_group_style_controller:function(e,n){"UL"==t(n).parent()[0].tagName?t(".group-style > button .text-controller-icon").attr("class","").addClass("mdb-unorder-list me_active active"):"OL"==t(n).parent()[0].tagName&&t(".group-style > button .text-controller-icon").attr("class","").addClass("mdb-order-list me_active active")},update_heading_controller:function(e,n){for(var o=["H1","H2","H3","H4","H5","H6","P"],i=!0,l=0;l<o.length;l++){if(1==t(n).closest("p").length){t(".heading > button .text-controller-icon").attr("class","").addClass("text-controller-icon mdb-heading-p"),i=!1;break}if(t(n).closest(o[l]).length){t(".heading > button .text-controller-icon").attr("class","").addClass("text-controller-icon mdb-heading-"+(1*l+1)),i=!1;break}}return 1==i?void t(".heading > button .text-controller-icon").attr("class","").addClass("text-controller-icon mdb-heading-p"):void 0},update_line_height_controller:function(e,n){if(0==e[0])var o="normal"==t(n).css("line-height")?0:t(n).css("line-height").replace("px",""),i=t(n).css("font-size").replace("px",""),l=o/i;else var l=e[1];t(".line-height-controller .dropdown-items .meditor-input").val(l)},update_font_family_controller:function(e,n){var o=0==e[0]?t(n).css("font-family").trim():e[1];t(".font-family").val(o),o=o.replace(/"/g,""),t(".meditor-defult-text").text(o)},update_color_controller:function(e,n){var o=0==e[0]?t(n).css("color"):e[1];try{t(".meditor-defult-font-color").css("background-color",this.rgb2hex(o))}catch(i){}},update_controller:function(t,e){if(e)var n=e;else var n=document.elementFromPoint(t.clientX,t.clientY);this.update_bold_controller(!1,n),this.update_italic_controller(!1,n),this.update_underline_controller(!1,n),this.update_list_controller([!1],n),this.update_alignment_controller([!1],n),this.update_font_size_controller([!1],n),this.update_letter_spacing_controller([!1],n),this.update_line_height_controller([!1],n),this.update_font_family_controller([!1],n),this.update_color_controller([!1],n),this.update_heading_controller([!1],n),this.update_group_style_controller([!1],n)},focused:function(e){e.prepend('<b id="meditor-empty-bold"></b>'),t("#meditor-empty-bold").remove()},get_selection_html:function(){var t="";if("undefined"!=typeof window.getSelection){var e=window.getSelection();if(e.rangeCount){for(var n=document.createElement("div"),o=0,i=e.rangeCount;i>o;++o)n.appendChild(e.getRangeAt(o).cloneContents());t=n.innerHTML;var l=e.getRangeAt(0).commonAncestorContainer;1!=l.nodeType&&(l=l.parentNode)}}else if("undefined"!=typeof document.selection&&"Text"==document.selection.type){t=document.selection.createRange().htmlText;var l=sel.createRange().parentElement()}var a={html:t,parent:l};return a},replace_selection_with_html:function(t){var e;if(window.getSelection&&window.getSelection().getRangeAt){e=window.getSelection().getRangeAt(0),e.deleteContents();var n=document.createElement("div");n.innerHTML=t;for(var o,i=document.createDocumentFragment();o=n.firstChild;)i.appendChild(o);e.insertNode(i)}else document.selection&&document.selection.createRange&&(e=document.selection.createRange(),t=3==node.nodeType?node.data:node.outerHTML,e.pasteHTML(t))}});var l={config:{selector:".meditor",default_html:'<span style="font-size:20px">Click here to edit.</span>',default_text:"Click here to edit.",button_classes:{"default":{save:[{name:"save",type:"button",tooltip:"save"}]},content:{bold:{name:"bold",type:"button",tooltip:"bold","class":"bold",icon:"B"},italic:{name:"italic",type:"button",tooltip:"italic","class":"italic",icon:"I"},underline:{name:"underline",type:"button",tooltip:"underline","class":"underline",icon:"U"},"group-style":{name:"group style",type:"dropdown","class":"group-style",data:{orderedlist:{name:"Numbered List",type:"button","class":"nlist",icon:"OL"},unorderedlist:{name:"Bullet List",type:"button","class":"blist",icon:"UL"},indent:{name:"indent",type:"button",tooltip:"indent","class":"indent",icon:"ID"},outdent:{name:"outdent",type:"button",tooltip:"outdent","class":"outdent",icon:"OD"}}},"list-styles":{name:"list style",type:"dropdown","class":"list-style",data:{orderedlist:{name:"Numbered List",type:"button","class":"nlist",icon:"OL"},unorderedlist:{name:"Bullet List",type:"button","class":"blist",icon:"UL"}}},alignment:{name:"Text Alignment",type:"dropdown","class":"text-alignment",data:{justifyright:{name:"justify Right",type:"button","class":"ralign",icon:"JR"},justifyleft:{name:"justify Left",type:"button","class":"lalign",icon:"JL"},justifycenter:{name:"justify Center",type:"button","class":"calign",icon:"JC"},justifyfull:{name:"justify",type:"button","class":"jalign",icon:"J"}}},fontsize:{name:"Font Size",type:"input",style:"number",placeholder:"insert font size","class":"font-size",have_input:!0},letterspace:{name:"Letter Space",type:"input",style:"number",placeholder:"insert letter space","class":"letter-space",have_input:!0},lineheight:{name:"Line Height ",type:"input",style:"number",placeholder:"insert line height","class":"line-height",have_input:!0},fontfamily:{name:"Font Family",type:"input",style:"text",placeholder:"insert Font Family",extra:"autocomplete","class":"font-family-controller",have_input:!0},color:{name:"Font Color",type:"input",style:"color",placeholder:"Change color","class":"font-color",have_input:!0},heading:{name:"Headings",type:"button",tooltip:"Heading","class":"heading",icon:"H1"},undoredomanger:{name:"Manger","class":"undo-redo-manger",data:{redo:{name:"redo",type:"button",tooltip:"redo","class":"redo",icon:">"},undo:{name:"undo",type:"button",tooltip:"undo","class":"undo",icon:"<"}}},link:{name:"Link",type:"input",style:"url",placeholder:"insert url","class":"link",icon:"a",have_input:!0}}}},models:e,views:n,collections:i,$editable:null,$editor:null,editable_init:function(e){this.config.selector=e,this.$editable=t(".inline-md-editor"),this.create_editor_panel();try{document.execCommand("StyleWithCSS",!1,!1)}catch(n){if("Invalid argument."!==n.message)throw n}this.add_events(),this.show_panel()},create_editor_panel:function(){if(this.$editor=t(".meditor-panel"),!this.$editor.length){this.$editor=t('<div class="meditor-panel unselectable ">');var e={editable:this.$editable,editable_model:this.model};document.body.appendChild(this.$editor[0]),this.$editor.meditor_instantiate({classType:"Editor",attrs:e})}},add_events:function(){this.editor_panel_events(),this.editor_content_events(),this.body_events(),t(document).paste_as_plain_text()},editor_content_events:function(){var e=this;this.$editable.off("mousedown.meditor"),this.$editable.on("mousedown.meditor",function(n){e.views.Editor.prototype.focused(t(n.target).closest(".meditor")),e.views.Editor.prototype.update_controller(n),t("#meditor_focus").length&&e.views.Editor.prototype.remove_text_selection(),e.views.Editor.prototype.close_color_picker(t("#meditor-color-picker")),e.views.Editor.prototype.close_dropdown()}),this.$editable.off("focus.meditor"),this.$editable.on("focus.meditor",function(n){e.show_panel(),t("#meditor_focus").text().trim()==e.config.default_text&&(t("#meditor_focus").html(""),e.views.Editor.prototype.update_controller(n,t("#meditor_focus")))}),this.$editable.off("click.meditor","a"),this.$editable.on("click.meditor","a",function(){var n=this;setTimeout(function(){
    var o=n,i=document.createRange();i.selectNodeContents(o),window.getSelection().removeAllRanges(),window.getSelection().addRange(i);var l=document.getElementById("meditor_focus");null!=l&&r(l),e.views.Editor.prototype.keep_text_selected(),t(".open-link-option").toggleClass("show-panel"),t(".link-input").val(t(o).attr("href")),e.views.Editor.prototype.link_panel()},10)})},editor_panel_events:function(){var e=this;this.$editor.off("mousedown.meditor"),this.$editor.on("mousedown.meditor",function(n){var i=n.target||n.srcElement;return t(i).closest(".dropdown-items").length?!1:(t(i).closest("#meditor-color-picker").length||e.views.Editor.prototype.close_color_picker(t("#meditor-color-picker")),t(i).closest(".open-link-option").length||t(i).closest(".active-item").next(".dropdown-items").hasClass("open")||e.views.Editor.prototype.close_dropdown(),void e.views.Editor.prototype.set_selection_range(document.getElementById("meditor_focus"),o.start,o.end))})},body_events:function(){var e=this;t("body").bind("mousedown.meditor",function(n){var o=n.target||n.srcElement;if(t(o).not(".meditor-panel, .meditor-panel *, .meditor-image-tools, .meditor-image-tools *").length){e.$editor.css({display:"none"});var i=t("#meditor_focus");t(".meditor-input").val(""),i.length&&(""==i.text().trim()&&i.html(e.config.default_html),e.views.Editor.prototype.remove_text_selection(),setTimeout(function(){i.attr("id","").parents(".mBuilder-element").not(".vc_row, .mBuilder-vc_column").removeClass("active-md-editor").draggable("enable")},10))}})},show_panel:function(){if(t("#meditor_focus").length){var e=this.$editable.filter("#meditor_focus").offset().top-50,n=this.$editable.filter("#meditor_focus").offset().left,o=t(window).width()-(n+this.$editable.filter("#meditor_focus").width()),i=this.$editable.filter("#meditor_focus").width()/2;250>n?t(".meditor-panel").css({top:e,left:n+154,right:""}):250>o?t(".meditor-panel").css({top:e,left:"",right:o-154}):t(".meditor-panel").css({top:e,left:n+i-154,right:""})}}};t.fn.meditor_instantiate=function(o,i){return this.each(function(){var l=t(this);o||(o={});var a={el:this,attrs:{}};_.extend(a,o);var r=new e[a.classType](a.attrs,a);if(_.isFunction(n[a.classType]))var s=new n[a.classType]({model:r,el:this,tagName:this.tagName});l.data({model:r}),l.data({view:s}),_.isFunction(i)&&i({model:r,view:s})})},t.fn.meditor_find_editable=function(){var e=t(this);return e.is(l.config.selector)?e:e.closest(l.config.selector)},t.fn.paste_as_plain_text=function(){t(this).unbind("paste").on("paste","[contenteditable]",function(t){t.preventDefault();var e=(t.originalEvent||t).clipboardData.getData("text/plain");document.execCommand("insertText",!1,e)})};var a=function(t){for(var e,n,o=0,i=font_name_list_len-1;i>=o;)if(e=(o+i)/2|0,n=this[e].substr(0,t.length).toLowerCase(),t>n)o=e+1;else{if(!(n>t))return e;i=e-1}return-1},r=function(t){var e;window.getSelection&&document.createRange?(e=function(t){var e=t.ownerDocument,n=e.defaultView;if(null!=n.getSelection().anchorNode){var i=n.getSelection().getRangeAt(0),l=i.cloneRange();l.selectNodeContents(t),l.setEnd(i.startContainer,i.startOffset);var a=l.toString().length;return o={start:a,end:a+i.toString().length},!0}})(t):document.selection&&(e=function(t){var e=t.ownerDocument,n=(e.defaultView||e.parentWindow,e.selection.createRange()),i=e.body.createTextRange();i.moveToElementText(t),i.setEndPoint("EndToStart",n);var l=i.text.length;return o={start:l,end:l+selectedTextRange.text.length},!0})(t)};window.meditor=l}(jQuery);